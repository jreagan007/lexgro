---
/**
 * GuideLayout - For pillar/guide pages (5000-8000 words)
 * Features: Table of contents, related content, long-form styling, breadcrumbs, schema
 */
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';

interface Props {
  title: string;
  description: string;
  author?: string;
  pubDate?: Date;
  updatedDate?: Date;
  heroImage?: string;
  slug?: string;
}

const { title, description, author = 'Keith Dyer', pubDate, updatedDate, heroImage, slug = '' } = Astro.props;

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Home', href: '/' },
  { label: 'Guides', href: '/guide/' },
  { label: title }
];

// Article schema for guide
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "author": {
    "@type": "Person",
    "name": author
  },
  "publisher": {
    "@type": "Organization",
    "name": "LEXGRO",
    "logo": {
      "@type": "ImageObject",
      "url": "https://lexgro.com/logo.png"
    }
  },
  ...(pubDate && { "datePublished": pubDate.toISOString() }),
  ...(updatedDate && { "dateModified": updatedDate.toISOString() }),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://lexgro.com/guide/${slug}/`
  }
};
---

<BaseLayout title={title} description={description}>
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />

  <article class="guide-article">
    <header class="guide-header">
      <div class="container">
        <Breadcrumbs items={breadcrumbItems} />
        <p class="guide-label">Complete Guide</p>
        <h1>{title}</h1>
        <p class="guide-description">{description}</p>
        <div class="guide-meta">
          {author && <span class="author">By {author}</span>}
          {pubDate && (
            <time datetime={pubDate.toISOString()}>
              {pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
          )}
        </div>
      </div>
    </header>

    <div class="guide-content container">
      <aside class="guide-toc">
        <nav>
          <p class="toc-title">In This Guide</p>
          <div id="toc-links">
            <!-- TOC populated by JS -->
          </div>
        </nav>
      </aside>

      <div class="guide-body prose">
        <slot />
      </div>
    </div>

    <footer class="guide-footer container">
      <div class="cta-block">
        <h3>Ready to Transform Your Law Firm's Marketing?</h3>
        <p>Get a free marketing and intake audit to identify growth opportunities.</p>
        <a href="https://calendly.com/lexgro/strategy-session" class="btn btn-primary">
          Schedule Your Free Audit
        </a>
      </div>
    </footer>
  </article>
</BaseLayout>

<style>
  .guide-article {
    --content-max-width: 800px;
  }

  .guide-header {
    background: var(--color-bg-dark);
    color: white;
    padding: 4rem 0 3rem;
  }

  .guide-label {
    color: var(--color-primary);
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1rem;
  }

  .guide-header h1 {
    font-size: clamp(2rem, 5vw, 3rem);
    line-height: 1.2;
    margin-bottom: 1rem;
    max-width: 900px;
  }

  .guide-description {
    font-size: 1.25rem;
    color: var(--color-text-light);
    max-width: 700px;
    margin-bottom: 1.5rem;
  }

  .guide-meta {
    display: flex;
    gap: 1.5rem;
    font-size: 0.875rem;
    color: var(--color-text-light);
  }

  .guide-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
    padding-top: 3rem;
    padding-bottom: 4rem;
  }

  @media (min-width: 1024px) {
    .guide-content {
      grid-template-columns: 250px 1fr;
    }
  }

  .guide-toc {
    position: sticky;
    top: 100px;
    height: fit-content;
  }

  .toc-title {
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    margin-bottom: 1rem;
  }

  .guide-body {
    max-width: var(--content-max-width);
  }

  .guide-footer {
    padding: 4rem 0;
    border-top: 1px solid var(--color-border);
  }

  .cta-block {
    background: var(--color-bg-light);
    padding: 3rem;
    border-radius: 14px;
    text-align: center;
  }

  .cta-block h3 {
    font-size: 1.5rem;
    margin-bottom: 0.75rem;
  }

  .cta-block p {
    color: var(--color-text-muted);
    margin-bottom: 1.5rem;
  }
</style>

<script>
  // Generate TOC from headings
  document.addEventListener('DOMContentLoaded', () => {
    const tocContainer = document.getElementById('toc-links');
    const headings = document.querySelectorAll('.guide-body h2, .guide-body h3');

    if (tocContainer && headings.length > 0) {
      headings.forEach((heading, index) => {
        if (!heading.id) {
          heading.id = `section-${index}`;
        }
        const link = document.createElement('a');
        link.href = `#${heading.id}`;
        link.textContent = heading.textContent;
        link.className = heading.tagName === 'H3' ? 'toc-link toc-link--sub' : 'toc-link';
        tocContainer.appendChild(link);
      });
    }
  });
</script>
